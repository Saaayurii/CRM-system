# ============================================
# СТРОИТЕЛЬНАЯ CRM - ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ
# ============================================
# Узнайте больше о конфигурации: [your-docs-url]
# Этот файл содержит все переменные окружения, необходимые для работы строительной CRM системы
# Скопируйте этот файл в .env и заполните реальными значениями

# ============================================
# НАСТРОЙКИ ПРИЛОЖЕНИЯ
# ============================================

# Окружение приложения
NODE_ENV=development
# Варианты: development, staging, production

# Название приложения
APP_NAME=Construction CRM

# Порт приложения (API Gateway)
PORT=3000

# URL приложения
APP_URL=http://localhost:3000

# URL фронтенда
FRONTEND_URL=http://localhost:3001

# Версия API
API_VERSION=v1

# ============================================
# БЕЗОПАСНОСТЬ И ШИФРОВАНИЕ
# ============================================

# Секретный ключ для подписи cookies и токенов
# ВАЖНО: Сгенерируйте безопасную случайную строку (минимум 64 символа)
# Используйте: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
SECRET_KEY_BASE=замените_на_длинный_безопасный_hex_минимум_64_символа

# JWT секреты (Сгенерируйте разные ключи для каждого)
# Используйте: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_ACCESS_SECRET=замените_на_секрет_access_токена
JWT_REFRESH_SECRET=замените_на_секрет_refresh_токена

# Время жизни JWT токенов
JWT_ACCESS_EXPIRATION=15m
JWT_REFRESH_EXPIRATION=7d

# Ключи шифрования для чувствительных данных (Паспорта, Финансовые данные)
# Генерация: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ENCRYPTION_KEY=замените_на_ключ_шифрования
ENCRYPTION_IV=замените_на_вектор_инициализации

# Хеширование паролей
BCRYPT_SALT_ROUNDS=10

# ============================================
# КОНФИГУРАЦИЯ БАЗЫ ДАННЫХ
# ============================================

# Основная база данных PostgreSQL
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/construction_crm?schema=public

# Индивидуальные настройки PostgreSQL (альтернатива DATABASE_URL)
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=construction_crm
POSTGRES_SCHEMA=public

# Пул соединений с базой данных
POSTGRES_POOL_MIN=2
POSTGRES_POOL_MAX=10

# Таймаут запросов к базе данных (в секундах)
POSTGRES_STATEMENT_TIMEOUT=30s

# Включить логирование базы данных (установите false в production)
POSTGRES_LOGGING=true

# ============================================
# КОНФИГУРАЦИЯ REDIS
# ============================================

# URL Redis (для кэширования, сессий, ограничения запросов, bull очередей)
REDIS_URL=redis://redis:6379

# Индивидуальные настройки Redis (альтернатива REDIS_URL)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Конфигурация Redis Sentinel (для высокой доступности)
# Список через запятую: sentinel_host1:port1,sentinel_host2:port2
REDIS_SENTINELS=
REDIS_SENTINEL_MASTER_NAME=mymaster
REDIS_SENTINEL_PASSWORD=

# Пул соединений Redis
REDIS_POOL_MIN=2
REDIS_POOL_MAX=10

# TTL кэша Redis (в секундах)
REDIS_CACHE_TTL=3600

# ============================================
# КОНФИГУРАЦИЯ МИКРОСЕРВИСОВ
# ============================================

# Порты сервисов
AUTH_SERVICE_PORT=3001
USERS_SERVICE_PORT=3002
PROJECTS_SERVICE_PORT=3003
TASKS_SERVICE_PORT=3004
MATERIALS_SERVICE_PORT=3005
SUPPLIERS_SERVICE_PORT=3006
FINANCE_SERVICE_PORT=3007
INSPECTIONS_SERVICE_PORT=3008
HR_SERVICE_PORT=3009
NOTIFICATIONS_SERVICE_PORT=3010

# URL сервисов (для межсервисной коммуникации)
AUTH_SERVICE_URL=http://auth-service:3001
USERS_SERVICE_URL=http://users-service:3002
PROJECTS_SERVICE_URL=http://projects-service:3003
TASKS_SERVICE_URL=http://tasks-service:3004
MATERIALS_SERVICE_URL=http://materials-service:3005
SUPPLIERS_SERVICE_URL=http://suppliers-service:3006
FINANCE_SERVICE_URL=http://finance-service:3007
INSPECTIONS_SERVICE_URL=http://inspections-service:3008
HR_SERVICE_URL=http://hr-service:3009
NOTIFICATIONS_SERVICE_URL=http://notifications-service:3010

# ============================================
# ОЧЕРЕДИ СООБЩЕНИЙ (Опционально - для будущего использования)
# ============================================

# Конфигурация RabbitMQ
RABBITMQ_URL=amqp://rabbitmq:5672
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=admin
RABBITMQ_PASSWORD=admin
RABBITMQ_VHOST=/

# Названия очередей
QUEUE_NOTIFICATIONS=notifications_queue
QUEUE_EMAILS=emails_queue
QUEUE_REPORTS=reports_queue
QUEUE_WEBHOOKS=webhooks_queue

# ============================================
# ОГРАНИЧЕНИЕ ЗАПРОСОВ И БЕЗОПАСНОСТЬ
# ============================================

# Ограничение запросов (используя Redis)
RATE_LIMIT_ENABLED=true
# TTL в секундах
RATE_LIMIT_TTL=900
# Максимум запросов за TTL
RATE_LIMIT_MAX=100

# Ограничение запросов для Auth endpoints
AUTH_RATE_LIMIT_TTL=900
AUTH_RATE_LIMIT_MAX=5

# Настройки CORS
CORS_ENABLED=true
CORS_ORIGIN=http://localhost:3001
# Список через запятую для нескольких источников
# CORS_ORIGIN=http://localhost:3001,https://yourdomain.com

# Включить белый список IP
IP_WHITELIST_ENABLED=false
# Список разрешенных IP через запятую
IP_WHITELIST=127.0.0.1,::1

# ============================================
# КОНФИГУРАЦИЯ EMAIL
# ============================================

# Провайдер email сервиса
# Варианты: smtp, sendgrid, mailgun, ses, postmark
EMAIL_PROVIDER=smtp

# Email адрес отправителя
MAIL_FROM_ADDRESS=noreply@construction-crm.com
MAIL_FROM_NAME=Construction CRM

# Конфигурация SMTP
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-email-password
SMTP_AUTH=true
SMTP_TLS=true

# Конфигурация SendGrid
SENDGRID_API_KEY=

# Конфигурация Mailgun
MAILGUN_API_KEY=
MAILGUN_DOMAIN=

# Конфигурация Amazon SES
AWS_SES_REGION=us-east-1
AWS_SES_ACCESS_KEY_ID=
AWS_SES_SECRET_ACCESS_KEY=

# Шаблоны email
EMAIL_TEMPLATES_PATH=./templates/emails

# ============================================
# ХРАНЕНИЕ ФАЙЛОВ
# ============================================

# Провайдер хранилища
# Варианты: local, s3, gcs, azure
STORAGE_PROVIDER=local

# Локальное хранилище
STORAGE_LOCAL_PATH=./uploads
STORAGE_LOCAL_URL=http://localhost:3000/uploads

# Amazon S3
AWS_S3_BUCKET_NAME=
AWS_S3_REGION=
AWS_S3_ACCESS_KEY_ID=
AWS_S3_SECRET_ACCESS_KEY=
AWS_S3_ENDPOINT=
# Установите true для path-style доступа (нужно для MinIO и некоторых S3-совместимых сервисов)
AWS_S3_FORCE_PATH_STYLE=false

# Google Cloud Storage
GCS_BUCKET_NAME=
GCS_PROJECT_ID=
GCS_KEYFILE_PATH=

# Azure Blob Storage
AZURE_STORAGE_ACCOUNT=
AZURE_STORAGE_ACCESS_KEY=
AZURE_STORAGE_CONTAINER=

# Ограничения загрузки файлов
MAX_FILE_SIZE=10485760
# 10MB в байтах
MAX_FILES_PER_UPLOAD=10
ALLOWED_FILE_TYPES=jpg,jpeg,png,pdf,doc,docx,xls,xlsx,dwg,dxf

# ============================================
# ЛОГИРОВАНИЕ И МОНИТОРИНГ
# ============================================

# Уровень логирования
# Варианты: error, warn, info, debug, verbose
LOG_LEVEL=info

# Логировать в stdout (рекомендуется для Docker)
LOG_TO_STDOUT=true

# Путь к файлу логов (если LOG_TO_STDOUT=false)
LOG_FILE_PATH=./logs/app.log

# Размер файла лога (в MB)
LOG_FILE_MAX_SIZE=10

# Хранение логов (в днях)
LOG_FILE_RETENTION_DAYS=14

# Включить логирование запросов
LOG_REQUESTS=true

# Включить логирование SQL запросов
LOG_SQL_QUERIES=false

# ============================================
# APM И ОТСЛЕЖИВАНИЕ ОШИБОК
# ============================================

# Sentry (Отслеживание ошибок)
SENTRY_ENABLED=false
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1

# New Relic
NEW_RELIC_ENABLED=false
NEW_RELIC_LICENSE_KEY=
NEW_RELIC_APP_NAME=Construction CRM

# Datadog
DATADOG_ENABLED=false
DATADOG_API_KEY=
DATADOG_APP_KEY=

# ============================================
# SWAGGER/OPENAPI ДОКУМЕНТАЦИЯ
# ============================================

# Включить Swagger UI
SWAGGER_ENABLED=true
SWAGGER_PATH=/api/docs

# Аутентификация Swagger
SWAGGER_USER=admin
SWAGGER_PASSWORD=admin

# ============================================
# ВНЕШНИЕ ИНТЕГРАЦИИ
# ============================================

# Google Maps API (для функций геолокации)
GOOGLE_MAPS_API_KEY=

# Google OAuth (для социальной авторизации)
GOOGLE_OAUTH_CLIENT_ID=
GOOGLE_OAUTH_CLIENT_SECRET=
GOOGLE_OAUTH_CALLBACK_URL=http://localhost:3000/auth/google/callback

# SMS провайдер (Twilio)
TWILIO_ENABLED=false
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=

# Push уведомления (Firebase Cloud Messaging)
FCM_ENABLED=false
FCM_SERVER_KEY=
FCM_PROJECT_ID=

# Платежный шлюз (Stripe)
STRIPE_ENABLED=false
STRIPE_PUBLIC_KEY=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=

# Интеграция с бухгалтерией (1C, QuickBooks, и т.д.)
ACCOUNTING_INTEGRATION_ENABLED=false
ACCOUNTING_API_URL=
ACCOUNTING_API_KEY=

# ============================================
# ФОНОВЫЕ ЗАДАЧИ И ПЛАНИРОВАНИЕ
# ============================================

# Настройки Bull Queue
BULL_BOARD_ENABLED=true
BULL_BOARD_PATH=/admin/queues
BULL_BOARD_USERNAME=admin
BULL_BOARD_PASSWORD=admin

# Параллельность задач
QUEUE_CONCURRENCY=5

# Настройки повтора задач
JOB_MAX_ATTEMPTS=3
JOB_BACKOFF_DELAY=5000

# ============================================
# CRON ЗАДАЧИ И ЗАПЛАНИРОВАННЫЕ ЗАДАНИЯ
# ============================================

# Включить запланированные задачи
CRON_ENABLED=true

# Генерация ежедневных отчетов (формат cron)
CRON_DAILY_REPORTS=0 6 * * *

# Еженедельный бэкап (формат cron)
CRON_WEEKLY_BACKUP=0 2 * * 0

# Ежемесячный анализ бюджета (формат cron)
CRON_MONTHLY_BUDGET=0 9 1 * *

# Очистка старых логов (формат cron)
CRON_CLEANUP_LOGS=0 3 * * *

# Отправка напоминаний (формат cron)
CRON_REMINDERS=0 */4 * * *

# ============================================
# НАСТРОЙКИ УВЕДОМЛЕНИЙ
# ============================================

# Каналы уведомлений
NOTIFICATIONS_EMAIL_ENABLED=true
NOTIFICATIONS_SMS_ENABLED=false
NOTIFICATIONS_PUSH_ENABLED=false
NOTIFICATIONS_IN_APP_ENABLED=true

# Троттлинг уведомлений (предотвращение спама)
NOTIFICATION_THROTTLE_ENABLED=true
NOTIFICATION_MAX_PER_HOUR=10

# ============================================
# ФЛАГИ ФУНКЦИЙ
# ============================================

# Включить/Выключить функции
FEATURE_MULTI_TENANCY=true
FEATURE_CLIENT_PORTAL=true
FEATURE_MOBILE_APP=false
FEATURE_REAL_TIME_CHAT=true
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_AI_PREDICTIONS=false
FEATURE_DOCUMENT_GENERATION=true
FEATURE_QR_CODE_TRACKING=true
FEATURE_GEOLOCATION=true

# ============================================
# НАСТРОЙКИ МУЛЬТИАРЕНДНОСТИ
# ============================================

# Стратегия изоляции арендаторов
# Варианты: schema, database, shared
TENANT_ISOLATION=schema

# Арендатор по умолчанию (для начальной настройки)
DEFAULT_TENANT_SUBDOMAIN=demo

# ============================================
# ЛОКАЛИЗАЦИЯ
# ============================================

# Язык по умолчанию
DEFAULT_LOCALE=ru
# Доступные языки (через запятую)
AVAILABLE_LOCALES=ru,en,lv

# Часовой пояс по умолчанию
DEFAULT_TIMEZONE=Europe/Riga

# Валюта по умолчанию
DEFAULT_CURRENCY=EUR

# ============================================
# БИЗНЕС-ПРАВИЛА И ОГРАНИЧЕНИЯ
# ============================================

# Максимум проектов на аккаунт
MAX_PROJECTS_PER_ACCOUNT=100

# Максимум пользователей на аккаунт
MAX_USERS_PER_ACCOUNT=500

# Максимум задач на проект
MAX_TASKS_PER_PROJECT=1000

# Таймаут сессии (в минутах)
SESSION_TIMEOUT=60

# Требования к паролю
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SPECIAL_CHARS=true

# ============================================
# РАЗРАБОТКА И ТЕСТИРОВАНИЕ
# ============================================

# Включить режим отладки
DEBUG=false

# Включить горячую перезагрузку
HOT_RELOAD=true

# Заполнить базу данных при запуске
SEED_DATABASE=false

# Тестовая база данных
TEST_DATABASE_URL=postgresql://postgres:postgres@localhost:5432/construction_crm_test?schema=public

# Мокировать внешние сервисы в разработке
MOCK_EXTERNAL_SERVICES=true

# ============================================
# ПРОИЗВОДИТЕЛЬНОСТЬ И ОПТИМИЗАЦИЯ
# ============================================

# Включить сжатие ответов
COMPRESSION_ENABLED=true

# Включить кэширование ответов
CACHE_ENABLED=true
CACHE_TTL=300

# Пул соединений с базой данных
DB_POOL_MIN=5
DB_POOL_MAX=20

# Таймаут запроса (в миллисекундах)
REQUEST_TIMEOUT=30000

# ============================================
# РЕЗЕРВНОЕ КОПИРОВАНИЕ И ВОССТАНОВЛЕНИЕ
# ============================================

# Включить автоматические бэкапы
BACKUP_ENABLED=false

# Место хранения бэкапов
# Варианты: local, s3, gcs
BACKUP_STORAGE=local
BACKUP_PATH=./backups

# Срок хранения бэкапов (в днях)
BACKUP_RETENTION_DAYS=30

# Расписание бэкапов (формат cron)
BACKUP_SCHEDULE=0 2 * * *

# ============================================
# ПРОВЕРКИ ЗДОРОВЬЯ
# ============================================

# Эндпоинты проверки здоровья
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health

# Проверка здоровья базы данных
DB_HEALTH_CHECK_ENABLED=true

# Проверка здоровья Redis
REDIS_HEALTH_CHECK_ENABLED=true

# ============================================
# КОНФИГУРАЦИЯ ВЕБХУКОВ
# ============================================

# Включить вебхуки
WEBHOOKS_ENABLED=false

# Секрет для подписи вебхуков
WEBHOOK_SECRET=

# Настройки повтора вебхуков
WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAY=5000

# ============================================
# АНАЛИТИКА И ОТЧЕТНОСТЬ
# ============================================

# Включить внутреннюю аналитику
ANALYTICS_ENABLED=true

# Google Analytics
GA_TRACKING_ID=

# Интеграция Metabase
METABASE_ENABLED=false
METABASE_URL=
METABASE_SECRET_KEY=

# ============================================
# НАСТРОЙКИ МОБИЛЬНОГО ПРИЛОЖЕНИЯ
# ============================================

# ID пакетов мобильных приложений
IOS_BUNDLE_ID=com.construction-crm.ios
ANDROID_BUNDLE_ID=com.construction-crm.android

# Deep Linking
DEEP_LINK_SCHEME=constructioncrm
DEEP_LINK_HOST=app

# ============================================
# РАСШИРЕННАЯ КОНФИГУРАЦИЯ
# ============================================

# Рабочие потоки
WORKER_THREADS=4

# Кластерный режим
CLUSTER_ENABLED=false
CLUSTER_WORKERS=auto

# Таймаут плавного завершения (в секундах)
GRACEFUL_SHUTDOWN_TIMEOUT=30

# ============================================
# ПОЛЬЗОВАТЕЛЬСКАЯ БИЗНЕС-ЛОГИКА
# ============================================

# Рабочие дни (через запятую, 1=Понедельник, 7=Воскресенье)
WORKING_DAYS=1,2,3,4,5

# Рабочие часы
WORKING_HOURS_START=08:00
WORKING_HOURS_END=18:00

# Множитель ставки за переработки
OVERTIME_RATE=1.5

# Ставка НДС (в процентах)
VAT_RATE=21

# Условия оплаты по умолчанию (в днях)
DEFAULT_PAYMENT_TERMS=30

# Штраф за просрочку платежа (в процентах)
LATE_PAYMENT_FEE=0.1

# ============================================
# СООТВЕТСТВИЕ И РЕГУЛИРОВАНИЕ
# ============================================

# Соответствие GDPR
GDPR_ENABLED=true
DATA_RETENTION_DAYS=2555
# 7 лет

# Включить журнал аудита
AUDIT_LOG_ENABLED=true

# Включить анонимизацию данных для удаленных пользователей
ANONYMIZE_DELETED_USERS=true

# ============================================
# КОНЕЦ КОНФИГУРАЦИИ
# ============================================
# Примечание: Перезапустите все сервисы после изменения переменных окружения
# Для production: Никогда не коммитьте .env файл с реальными секретами в систему контроля версий
