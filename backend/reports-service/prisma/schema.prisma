generator client { provider = "prisma-client-js" }
datasource db { provider = "postgresql"; url = env("DATABASE_URL") }

model Account {
  id Int @id @default(autoincrement())
  name String @db.VarChar(255)
  status Int @default(1)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
  reportTemplates ReportTemplate[]
  generatedReports GeneratedReport[]
  @@map("accounts")
}

model ReportTemplate {
  id Int @id @default(autoincrement())
  accountId Int @map("account_id")
  name String @db.VarChar(255)
  reportType String? @map("report_type") @db.VarChar(100)
  description String? @db.Text
  configuration Json @default("{}")
  allowedRoles Json @default("[]") @map("allowed_roles")
  createdByUserId Int? @map("created_by_user_id")
  isActive Boolean @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
  account Account @relation(fields: [accountId], references: [id], onDelete: Cascade)
  generatedReports GeneratedReport[]
  @@map("report_templates")
}

model GeneratedReport {
  id Int @id @default(autoincrement())
  accountId Int @map("account_id")
  reportTemplateId Int? @map("report_template_id")
  reportName String? @map("report_name") @db.VarChar(255)
  periodStart DateTime? @map("period_start") @db.Date
  periodEnd DateTime? @map("period_end") @db.Date
  projectId Int? @map("project_id")
  constructionSiteId Int? @map("construction_site_id")
  reportData Json? @map("report_data")
  fileUrl String? @map("file_url") @db.VarChar(500)
  generatedByUserId Int? @map("generated_by_user_id")
  generatedAt DateTime @default(now()) @map("generated_at")
  createdAt DateTime @default(now()) @map("created_at")
  account Account @relation(fields: [accountId], references: [id], onDelete: Cascade)
  reportTemplate ReportTemplate? @relation(fields: [reportTemplateId], references: [id])
  @@index([reportTemplateId])
  @@index([projectId])
  @@map("generated_reports")
}
